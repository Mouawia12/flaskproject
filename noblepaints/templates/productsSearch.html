{% extends 'sec.html' %}
{% set page_title_key = 'nav.business_solutions.product_search' %}
{% set page_translations = {
    'en': {
        'products_search.hero.title': 'Product Search',
        'products_search.hero.subtitle': 'Find the right coating by category, country or keyword.',
        'products_search.filters.heading': 'Filter products',
        'products_search.filters.search_placeholder': 'Search products…',
        'products_search.filters.country': 'Select a country',
        'products_search.filters.category': 'Category',
        'products_search.filters.all': 'All',
        'products_search.empty': 'No products match your filters yet. Try another search.',
    },
    'ar': {
        'products_search.hero.title': 'البحث عن المنتجات',
        'products_search.hero.subtitle': 'اعثر على الطلاء المناسب حسب الفئة أو الدولة أو الكلمات المفتاحية.',
        'products_search.filters.heading': 'فلترة المنتجات',
        'products_search.filters.search_placeholder': 'ابحث عن المنتجات…',
        'products_search.filters.country': 'اختر الدولة',
        'products_search.filters.category': 'الفئة',
        'products_search.filters.all': 'الكل',
        'products_search.empty': 'لا توجد منتجات مطابقة للبحث حتى الآن. جرّب كلمات أخرى.',
    }
} %}

{% block head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" referrerpolicy="no-referrer">
<link rel="stylesheet" href="{{ url_for('static', filename='css/products.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/props.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/productsSearch.css') }}">
<style>
    .subpage--product-search {
        position: relative;
        padding: 120px 0 90px;
        background-size: cover;
        background-position: center;
        color: #fff;
    }

    .subpage--product-search::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, rgba(4, 32, 58, 0.82), rgba(4, 32, 58, 0.35));
    }

    .subpage--product-search .subpage__inner {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
    }

    .subpage--product-search h1 {
        font-size: clamp(2rem, 2.6vw, 3rem);
        font-weight: 700;
        margin: 0;
    }

    .subpage--product-search p {
        max-width: 640px;
        font-size: 1rem;
        margin: 0;
    }

    .product-empty-state {
        padding: 3rem 1.5rem;
        text-align: center;
        border-radius: 24px;
        background: rgba(17, 46, 77, 0.04);
        border: 1px solid rgba(17, 46, 77, 0.08);
        color: var(--brand-secondary);
        font-weight: 600;
    }
</style>
{% endblock %}

{% block hero %}
<header class="subpage subpage--product-search" style="background-image: url('{{ url_for('static', filename='images/header10.jpg') }}');">
    <div class="container2 subpage__inner">
        <nav class="breadcrumb" aria-label="breadcrumb">
            <a class="breadcrumb-item" href="{{ url_for_lang('home_page') }}" data-i18n-key="nav.home"></a>
            <span class="breadcrumb-item active" data-i18n-key="nav.business_solutions.product_search"></span>
        </nav>
        <div>
            <h1 data-i18n-key="products_search.hero.title"></h1>
            <p data-i18n-key="products_search.hero.subtitle"></p>
        </div>
    </div>
</header>
{% endblock %}

{% block content %}
{% set country_options = [
    'All', 'Algeria', 'Bahrain', 'Canada', 'Denmark', 'Egypt', 'France', 'Germany', 'India', 'Iraq',
    'Italy', 'Kuwait', 'Kyrgyzstan', 'Libya', 'Morocco', 'Oman', 'Qatar', 'Saudi Arabia', 'Sudan',
    'Tanzania', 'South Africa', 'UAE', 'United States', 'Yemen'
] %}
<section class="product-search__content py-5">
    <div class="container2 products">
        <div class="row">
            <aside class="filters">
                <h3 class="title" data-i18n-key="products_search.filters.heading"></h3>
                <div class="filter-professionals">
                    <form>
                        <div class="filed-wrap search-wrap">
                            <input type="text" id="SearchKeywords" value="{{ search or '' }}" placeholder="" data-i18n-key="products_search.filters.search_placeholder" data-i18n-attr="placeholder">
                            <button id="Searchbtn" type="submit" aria-label="Search">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                        <div class="filed-wrap">
                            <label for="selectCountries" class="field-title" data-i18n-key="products_search.filters.country"></label>
                            <div class="select-wrap">
                                <select name="country" id="selectCountries" value="{{ country }}">
                                    {% for option in country_options %}
                                        <option value="{{ option }}" {% if country == option %}selected{% endif %}>{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="filed-wrap radio-fields">
                            <label class="field-title" data-i18n-key="products_search.filters.category"></label>
                            <div class="radio-wrap" data-category-option>
                                <div class="check-wrap checked">
                                    <input type="radio" class="radioSegments" value="All" id="seg0" {% if category == 'All' %}checked{% endif %}>
                                </div>
                                <label for="seg0" data-category-value="All" data-i18n-key="products_search.filters.all"></label>
                            </div>
                            <div class="category-options">
                                {% for x in categories %}
                                    {% set option_id = 'seg' ~ x.id %}
                                    <div class="radio-wrap" data-category-option>
                                        <div class="check-wrap">
                                            <input type="radio" name="radioSegments" class="radioSegments" value="{{ x.id }}" id="{{ option_id }}" data-category-name="{{ x.name }}">
                                        </div>
                                        <label for="{{ option_id }}" data-category-value="{{ x.id }}" data-label-en="{{ x.name }}" data-label-ar="{{ x.nameArabic or x.name }}">{{ x.name }}</label>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </form>
                </div>
            </aside>
            <section class="products">
                <div class="products-wrap">
                    {% set page_size = 12 %}
                    {% set start = (page|int - 1) * page_size %}
                    {% set end = start + page_size %}
                    {% set paginated_items = items[start:end] %}
                    {% if paginated_items %}
                        {% for x in paginated_items %}
                            <div class="product-item" lang="{{ x.lang }}" idNum="{{ x.id }}">
                                <a href="/product/?id={{ x.id }}">
                                    <picture>
                                        {% if x.img %}
                                            <img src="{{ x.img }}" alt="product">
                                        {% else %}
                                            <img src="{{ url_for('static', filename='images/prod01.png') }}" alt="product">
                                        {% endif %}
                                    </picture>
                                    <h3>{{ x.name }}</h3>
                                    <p>{{ x.desc|safe }}</p>
                                </a>
                                <a href="/product/?id={{ x.id }}" class="LearnMore">Learn More</a>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="product-empty-state" data-i18n-key="products_search.empty"></div>
                    {% endif %}
                </div>
                {% set total_pages = ((items|length) / page_size)|round(0, 'ceil')|int %}
                {% if total_pages > 1 %}
                <div class="col-md-12">
                    <div class="card-footer px-3 border-0 d-flex flex-column flex-lg-row align-items-center justify-content-between" style="background: transparent;">
                        <nav aria-label="Product pagination">
                            <ul class="pagination mb-0">
                                <li class="page-item {% if page|int < 2 %}disabled{% endif %}">
                                    <a class="page-link text" href="#" onclick="location.href=`/productsSearch/?page={{ page|int - 1 }}&category=${getParams('category') || 'All'}&search=${getParams('search') || ''}&country=${getParams('country') || 'All'}&lang=${getLang()}`">Previous</a>
                                </li>
                                {% for i in range(1, total_pages + 1) %}
                                    <li class="page-item {% if i|string in page %}active{% endif %}">
                                        <a class="page-link" href="#" onclick="location.href=`/productsSearch/?page={{ i }}&category=${getParams('category') || 'All'}&search=${getParams('search') || ''}&country=${getParams('country') || 'All'}&lang=${getLang()}`">{{ i }}</a>
                                    </li>
                                {% endfor %}
                                <li class="page-item {% if paginated_items|length < page_size or (page|int) >= total_pages %}disabled{% endif %}">
                                    <a class="page-link text" href="#" onclick="location.href=`/productsSearch/?page={{ page|int + 1 }}&category=${getParams('category') || 'All'}&search=${getParams('search') || ''}&country=${getParams('country') || 'All'}&lang=${getLang()}`">Next</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
                {% endif %}
            </section>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    window.PAGE_TRANSLATIONS = Object.assign(window.PAGE_TRANSLATIONS || {}, {{ page_translations | tojson }});
</script>
<script src="{{ url_for('static', filename='js/productsSearch.js') }}"></script>
{% endblock %}
